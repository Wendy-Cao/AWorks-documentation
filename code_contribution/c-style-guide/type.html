

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.2.1. 变量、结构、类型 &mdash; AWorks 文档中心 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/pdflogo.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="AWorks 文档中心 1.0.0 documentation" href="../../index.html"/>
        <link rel="up" title="7.2. C代码规范" href="index.html"/>
        <link rel="next" title="7.2.2. 语句、语句块、赋值与运算符" href="statement-operator.html"/>
        <link rel="prev" title="7.2. C代码规范" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> AWorks 文档中心
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">目  录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">1. AWorks简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">2. 快速上手</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../axio/index.html">3. AXIO 工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guides/index.html">4. 用户指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/index.html">5. API 参考手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demos/index.html">6. 示例程序</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">7. 代码贡献</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../contributors.html">7.1. 贡献者</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">7.2. C代码规范</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">7.2.1. 变量、结构、类型</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">7.2.1.1. 变量初始化</a></li>
<li class="toctree-l4"><a class="reference internal" href="#my-reference-label">7.2.1.2. 变量命名</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">7.2.1.3. 结构变量与类型</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="statement-operator.html">7.2.2. 语句、语句块、赋值与运算符</a></li>
<li class="toctree-l3"><a class="reference internal" href="function.html">7.2.3. 函数、函数名及其参数</a></li>
<li class="toctree-l3"><a class="reference internal" href="readability.html">7.2.4. 可读性结构与标识符</a></li>
<li class="toctree-l3"><a class="reference internal" href="comment.html">7.2.5. 注释、注释对齐</a></li>
<li class="toctree-l3"><a class="reference internal" href="macro.html">7.2.6. 宏定义</a></li>
<li class="toctree-l3"><a class="reference internal" href="file.html">7.2.7. 文件相关</a></li>
<li class="toctree-l3"><a class="reference internal" href="CHANGELOG.html">7.2.8. 更改记录</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">8. 常见问题及解答（FAQ）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">9. 附录</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">AWorks 文档中心</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">7. 代码贡献</a> &raquo;</li>
      
          <li><a href="index.html">7.2. C代码规范</a> &raquo;</li>
      
    <li>7.2.1. 变量、结构、类型</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/code_contribution/c-style-guide/type.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>7.2.1. 变量、结构、类型<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>7.2.1.1. 变量初始化<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>不合理的初始化数据是产生编程错误的常见根源。不恰当的变量初始化所导致的一系列问题都源于变量的默认初始值与预期的不同。70%软件问题都源于内存错误，指针变量是错误的核心。</p>
<p><strong>要求</strong>：</p>
<ol class="arabic simple">
<li>尽量在定义变量的时候初始化。</li>
<li>局部指针变量必须初始化。</li>
<li>在使用全局变量时尽量进行有效范围检查，使用指针型全局变量必须进行有效性检查。</li>
<li>尽量在靠近第一次使用变量的地方声明和定义变量。例如，全局变量可以定义在初始化该变量的文件中。</li>
<li>尽量避免使用全局变量，如果只在一个函数内使用的全局变量，尽量使用 <code class="docutils literal notranslate"><span class="pre">static</span></code> 变量，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">static_auto_example</span></code>  所示：</li>
</ol>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="static-auto-example">
<div class="code-block-caption"><span class="caption-text">static 变量使用范例</span><a class="headerlink" href="#static-auto-example" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">g_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="cm">/* 状态变量 */</span>

<span class="kt">void</span> <span class="nf">led_swap</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">g_state</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">;</span>
        <span class="n">led_on</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">g_state</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
        <span class="n">led_off</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* 以上程序应该改为如下程序 */</span>
<span class="kt">void</span> <span class="nf">led_swap</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="kt">int</span>  <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span>  <span class="mi">1</span><span class="p">;</span>
        <span class="n">led_on</span><span class="p">();</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">state</span> <span class="o">=</span>  <span class="mi">0</span><span class="p">;</span>
        <span class="n">led_off</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
<ol class="arabic simple" start="6">
<li>与第五条类似，如果某全局变量只在一个文件中使用，应定义为 <code class="docutils literal notranslate"><span class="pre">static</span></code> 变量。</li>
</ol>
<blockquote>
<div><div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">static</span></code> 变量会导致函数不可重入，同时也限制了模块不能多实例，更推荐的做法是使用 OO 方法来设计模块，即使用结构体来封装变量。</p>
</div>
</div></blockquote>
</div>
<div class="section" id="my-reference-label">
<span id="id3"></span><h2>7.2.1.2. 变量命名<a class="headerlink" href="#my-reference-label" title="Permalink to this headline">¶</a></h2>
<p>为变量命名时最重要的考虑事项是，该名字要完全、准确地描述出该变量所代表的事物。这个名字应该便于阅读，容易记忆，不能产生歧义。变量名的长度，最佳的变量名长度应该在8到16个字符之间，当变量名太短时，需要花费大量的时间来判断变量的含义。单字符的变量只能用于循环变量或者数组下标。</p>
<p><strong>要求</strong>：</p>
<p>全部使用小写字符，必要时可添加下划线。变量名最多由三部分组成：作用域、类型、描述。</p>
<ol class="arabic simple">
<li>作用域：该变量的作用范围，确定该变量的有效范围是在函数体外还是函数体内。</li>
<li>类型：该变量的类型，使用小写字符。只有指针（包括函数指针）类型变量需要在命名中使用类型。</li>
<li>描述：要完全、准确地描述出该变量所代表的事物，例如： <code class="docutils literal notranslate"><span class="pre">max</span></code> 、 <code class="docutils literal notranslate"><span class="pre">error</span></code> 、 <code class="docutils literal notranslate"><span class="pre">new</span></code> 等等。</li>
</ol>
<div class="section" id="id4">
<h3>7.2.1.2.1. 全局变量的定义<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>全局变量的命名以 <code class="docutils literal notranslate"><span class="pre">g</span></code> 开头，例如： <code class="docutils literal notranslate"><span class="pre">g_max</span></code>。
如果使用指针类型，则在 <code class="docutils literal notranslate"><span class="pre">g</span></code> 后面加小写 <code class="docutils literal notranslate"><span class="pre">p</span></code> ，例如： <code class="docutils literal notranslate"><span class="pre">gp_value</span></code> 。
如果是函数指针类型，则在 <code class="docutils literal notranslate"><span class="pre">g</span></code> 后面加小写 <code class="docutils literal notranslate"><span class="pre">pfn</span></code> ，例如： <code class="docutils literal notranslate"><span class="pre">gpfn_io_read</span></code> 。
静态全局变量需要加上 <code class="docutils literal notranslate"><span class="pre">__</span></code> 前缀，例如， <code class="docutils literal notranslate"><span class="pre">__g_max</span></code> 、 <code class="docutils literal notranslate"><span class="pre">__gp_value</span></code> 、 <code class="docutils literal notranslate"><span class="pre">__gpfn_io_read</span></code> 。</p>
<p>变量类型后紧跟变量的描述，变量的描述使用小写加下划线，例如： <code class="docutils literal notranslate"><span class="pre">name</span></code>、<code class="docutils literal notranslate"><span class="pre">error_number</span></code> 等等。</p>
<p><strong>要求</strong>:</p>
<ol class="arabic simple">
<li>禁止使用拼音作为变量的描述。</li>
<li>变量名全部使用小写加下划线，不允许使用大小写混合方式。</li>
<li>函数指针类型变量统一使用 <code class="docutils literal notranslate"><span class="pre">pfn</span></code> 类型缩写。</li>
<li>为了避免模块与用户程序或其他模块产生命名冲突，模块内部使用的全局变量命名中还应加上特有的标识作为命名空间。</li>
</ol>
<p>下面给出一些模块内部全局变量的定义范例。例如，我们提供给用户一个直流电机控制软件包，软件包内定义了一些全局变量供我们自己使用，同时为了防止与用户程序或其他模块产生命名冲突，我们在定义模块内全局变量时把 <code class="docutils literal notranslate"><span class="pre">motor</span></code> 作为命名空间，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">local_global_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="local-global-def">
<div class="code-block-caption"><span class="caption-text">模块内部全局变量定义</span><a class="headerlink" href="#local-global-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>                    <span class="n">g_motor_max</span><span class="p">;</span>                    <span class="cm">/* 最大值 */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">__g_motor_error_number</span><span class="p">;</span>           <span class="cm">/* 错误号 */</span>
<span class="k">static</span> <span class="kt">signed</span> <span class="kt">int</span>    <span class="n">__g_motor_start_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="cm">/* 起始数值 */</span>

<span class="k">static</span> <span class="kt">char</span>          <span class="n">__g_motor_first</span><span class="p">;</span>                  <span class="cm">/* 第一个字符 */</span>
<span class="k">static</span> <span class="kt">char</span>          <span class="n">__g_motor_name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;zlg mcu&quot;</span><span class="p">;</span>     <span class="cm">/* 名字字符串 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>其他要求</strong>：</p>
<ol class="arabic simple">
<li>在连续定义多个全局变量的时候必须对齐。</li>
<li>右边加入对每一个全局变量作用的行注释。</li>
<li>不允许使用 <code class="docutils literal notranslate"><span class="pre">TAB键</span></code> 作缩进。（缩进单位为 4 个空格）</li>
<li>在不同类型全局变量或不同含义的全局变量定义之间要加入空行。如下面的程序清单所
示，在记录超时时间的三个变量和记录数据报个数的三个变量定义间加一个空行。</li>
</ol>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-blank-line-in-var-def">
<div class="code-block-caption"><span class="caption-text">变量定义中空行的使用范例</span><a class="headerlink" href="#example-blank-line-in-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_ip_default_timeout</span><span class="p">;</span>  <span class="cm">/* IP 数据报超时时间 */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_tcp_default_timeout</span><span class="p">;</span> <span class="cm">/* TCP 数据报超时时间 */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_udp_default_timeout</span><span class="p">;</span> <span class="cm">/* UDP 数据报超时时间 */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_ip_pack_counter</span><span class="p">;</span>     <span class="cm">/* IP 数据报计数器 */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_udp_pack_counter</span><span class="p">;</span>    <span class="cm">/* UDP 数据报计数器 */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">__g_tcp_pack_counter</span><span class="p">;</span>    <span class="cm">/* TCP 数据报计数器 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>所有程序中，注释必须使用封闭式注释： <code class="docutils literal notranslate"><span class="pre">/*</span> <span class="pre">…</span> <span class="pre">*/</span></code> 。</li>
<li>在变量后空至少1个空格开始行注释，行注释起始以相同类型变量中最靠右的为基准对齐
，行注释结束不必对齐，但行注释结束处不能超过第80列。</li>
<li>行注释的第一个字符与 <code class="docutils literal notranslate"><span class="pre">/*</span></code> 符号间至少保留一个空格。</li>
<li>变量类型必须写在一行的起始位置，除非含有 <code class="docutils literal notranslate"><span class="pre">extern</span></code> 关键字或者其他宏定义。</li>
</ol>
<p>模块中指针型全局变量的定义与对齐，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_static_global_var_align</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-static-global-var-align">
<div class="code-block-caption"><span class="caption-text">模块中指针型全局变量的定义与对齐范例：</span><a class="headerlink" href="#example-static-global-var-align" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span>   <span class="n">__g_max</span><span class="p">;</span>   <span class="cm">/* 最大值 */</span>
<span class="k">static</span> <span class="kt">int</span>  <span class="o">*</span><span class="n">__gp_Max</span><span class="p">;</span>  <span class="cm">/* 最大值指针 */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="o">**</span><span class="n">__gpp_max</span><span class="p">;</span> <span class="cm">/* 最大值双指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>要求</strong> ：</p>
<ol class="arabic simple">
<li>对齐的基准是英文字符或下划线。</li>
<li>指针变量的类型字符前缀 <code class="docutils literal notranslate"><span class="pre">p</span></code> 紧跟作用域字符 <code class="docutils literal notranslate"><span class="pre">g</span></code> 。</li>
<li>指针变量标志 <code class="docutils literal notranslate"><span class="pre">*</span></code> 必须紧跟变量名。例外情况，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_pointer_def_exeption</span></code> 所示。</li>
</ol>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-pointer-def-exeption">
<div class="code-block-caption"><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">*</span></code> 与变量名不贴近的例外情况范例</span><a class="headerlink" href="#example-pointer-def-exeption" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="o">*</span> <span class="k">const</span>  <span class="n">ptr2</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>禁止使用三重以上的指针。</li>
</ol>
<p><strong>要求</strong>：</p>
<ol class="arabic simple">
<li>变量有初始化时，赋值符号 <code class="docutils literal notranslate"><span class="pre">=</span></code> 左右必须使用空格。</li>
<li>左端的空格的个数以上下对齐为准。</li>
<li>在保证右端对齐的情况下，右端的空格数力求最少（不少于一个）。</li>
</ol>
<p>指针型全局变量的定义，与非指针全局变量的对齐，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_global_pointer_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-global-pointer-def">
<div class="code-block-caption"><span class="caption-text">指针型全局变量的定义与对齐范例</span><a class="headerlink" href="#example-global-pointer-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>       <span class="n">g_max</span><span class="p">;</span>    <span class="cm">/**&lt; 最大值 */</span>
<span class="kt">int</span>      <span class="o">*</span><span class="n">gp_max</span><span class="p">;</span>   <span class="cm">/**&lt; 最大值指针 */</span>
<span class="kt">int</span>     <span class="o">**</span><span class="n">gpp_max</span><span class="p">;</span>  <span class="cm">/**&lt; 最大值双指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>含有 <code class="docutils literal notranslate"><span class="pre">extern</span></code> 关键字或者其他宏定义的变量书写范例，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_extern_macro_var_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-extern-macro-var-def">
<div class="code-block-caption"><span class="caption-text">含有 <code class="docutils literal notranslate"><span class="pre">extern</span></code> 关键字或者其他宏定义的变量书写范例</span><a class="headerlink" href="#example-extern-macro-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define EXT       extern</span>

<span class="k">extern</span> <span class="kt">int</span>        <span class="n">g_max</span><span class="p">;</span>    <span class="cm">/**&lt; 最大值 */</span>
<span class="k">extern</span> <span class="kt">int</span>       <span class="o">*</span><span class="n">gp_max</span><span class="p">;</span>   <span class="cm">/**&lt; 最大值指针 */</span>
<span class="k">extern</span> <span class="kt">int</span>      <span class="o">**</span><span class="n">gpp_max</span><span class="p">;</span>  <span class="cm">/**&lt; 最大值双指针 */</span>

<span class="n">EXT</span>    <span class="kt">int</span>        <span class="n">g_mix</span><span class="p">;</span>    <span class="cm">/**&lt; 最小值 */</span>
<span class="n">EXT</span>    <span class="kt">int</span>       <span class="o">*</span><span class="n">gp_mix</span><span class="p">;</span>   <span class="cm">/**&lt; 最小值指针 */</span>
<span class="n">EXT</span>    <span class="kt">int</span>      <span class="o">**</span><span class="n">gpp_mix</span><span class="p">;</span>  <span class="cm">/**&lt; 最小值双指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>要求</strong> ：</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">extern</span></code> 关键字或者其他宏定义必须写在一行的起始位置。</li>
<li><code class="docutils literal notranslate"><span class="pre">extern</span></code> 关键字或者其他宏定义后面至少加一个空格。</li>
<li>同类型或含义类似变量类型字段应该对齐。</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id5">
<h3>7.2.1.2.2. 局部变量的定义<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>局部变量的定义与全局变量基本相同，但是，局部变量前不加双下划线 <code class="docutils literal notranslate"><span class="pre">__</span></code> 和作用域字符。只包含指针类型和变量的描述。下面给出一些全局变量的定义范例。如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_local_var_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-local-var-def">
<div class="code-block-caption"><span class="caption-text">局部变量定义范例</span><a class="headerlink" href="#example-local-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>      <span class="n">sheep_number</span><span class="p">;</span>          <span class="cm">/* 绵羊的数量 */</span>
<span class="kt">int</span>     <span class="o">*</span><span class="n">p_car_number</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>   <span class="cm">/* 指向车辆数目的指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>要求</strong> ：</p>
<ol class="arabic simple">
<li>局部变量只包含指针变量类型和变量描述这两部分内容。</li>
<li>定义局部指针型变量时，必须初始化为 <code class="docutils literal notranslate"><span class="pre">NULL</span></code> 或者一个有意义的地址，以减少发生错误的可能性。不允许出现悬空指针（指向无效地址的指针，俗称：野指针）。</li>
<li>指针变量标志 <code class="docutils literal notranslate"><span class="pre">*</span></code> 必须紧跟变量名。</li>
<li>变量名对齐时，指针符号应该向左移动，以英文字母或下划线作为起始对齐点。</li>
<li>在不同类型局部变量或不同含义的局部变量定义之间要加入空行。</li>
<li>函数的第一行代码与最后一个局部变量定义之间至少保留一个空行。当变量定义中使用空行时，第一行代码与最后一个局部变量定义之间保留两个空行，其它情况保留一个空行。</li>
<li>静态局部变量命名以 <code class="docutils literal notranslate"><span class="pre">s_</span></code> 开头。</li>
</ol>
<p>指针型变量定义，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_pointer_local_var_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-pointer-local-var-def">
<div class="code-block-caption"><span class="caption-text">指针型局部变量定义范例</span><a class="headerlink" href="#example-pointer-local-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">char</span>     <span class="o">*</span><span class="n">p_name</span>        <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>     <span class="cm">/* 名字指针 */</span>
<span class="kt">int</span>     <span class="o">**</span><span class="n">pp_car_number</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>     <span class="cm">/* 指向汽车数量指针地址的指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>局部变量中的特例：循环变量与数组下标变量。循环变量与数组下标变量允许超越以上要求，允许使用单字符变量名。如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_local_circal_array_var_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-local-circal-array-var-def">
<div class="code-block-caption"><span class="caption-text">局部循环变量与数组下标变量定义</span><a class="headerlink" href="#example-local-circal-array-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span>     <span class="n">i</span><span class="p">;</span>  <span class="cm">/* 循环变量 */</span>
<span class="kt">short</span>   <span class="n">s</span><span class="p">;</span>  <span class="cm">/* 数组下标 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>静态局部变量的定义如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_static_var_def</span></code> 所示</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-static-var-def">
<div class="code-block-caption"><span class="caption-text">静态局部变量定义</span><a class="headerlink" href="#example-static-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">motor_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="hll">    <span class="k">static</span> <span class="kt">bool</span>  <span class="n">s_inited</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>  <span class="cm">/* 模块已初始化标识 */</span>
</span>
    <span class="kt">int</span>          <span class="n">counter</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="cm">/* 计数器 */</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">s_inited</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">s_inited</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="id6">
<h2>7.2.1.3. 结构变量与类型<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id7">
<h3>7.2.1.3.1. 模块内结构体命名与定义<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>为了不污染用户命名空间，非应用程序（模块内部）使用的结构体与类型必须以双下划线开
始 <code class="docutils literal notranslate"><span class="pre">__</span></code> 。下面是一个非应用程序结构体定义范例，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_module_struct_member_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-module-struct-member-def">
<div class="code-block-caption"><span class="caption-text">模块内部结构体变量定义范例</span><a class="headerlink" href="#example-module-struct-member-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">__dlist</span> <span class="p">{</span>
    <span class="kt">int</span>                  <span class="n">value</span><span class="p">;</span>         <span class="cm">/* 节点的数值 */</span>

    <span class="k">struct</span> <span class="n">__dlist</span>      <span class="o">*</span><span class="n">p_next</span><span class="p">;</span>        <span class="cm">/* 双链表前向指针 */</span>
    <span class="k">struct</span> <span class="n">__dlist</span>      <span class="o">*</span><span class="n">p_prev</span><span class="p">;</span>        <span class="cm">/* 双链表后向指针 */</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">__dlist</span>   <span class="n">__dlist_t</span><span class="p">;</span>     <span class="cm">/* 定义类型 */</span>

<span class="cm">/* 需要使用struct __dlist的结构体 */</span>
<span class="k">struct</span> <span class="n">__my_app_struct</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">__dlist</span>   <span class="n">dlist_node</span><span class="p">;</span>        <span class="cm">/* 链表节点 */</span>
    <span class="k">struct</span> <span class="n">__dlist</span>  <span class="o">*</span><span class="n">p_dlist_head</span><span class="p">;</span>      <span class="cm">/* 链表头指针 */</span>
    <span class="kt">void</span>           <span class="p">(</span><span class="o">*</span><span class="n">pfn_act</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>    <span class="cm">/* 动作函数指针 */</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_module_struct_member_def</span></code> 所示。结构体的名字应该能够准确描述出该变量所代表的事物，这里将双
链表定义为 <code class="docutils literal notranslate"><span class="pre">__dlist</span></code> ，清晰易懂。结构体变量名中间允许插入下划线。</p>
<p>组合关键字中间为一个空格，例如： <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code>  、 <code class="docutils literal notranslate"><span class="pre">typedef</span> <span class="pre">struct</span></code> 等等。</p>
<p><strong>要求</strong> ：</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">struct</span></code> 关键字必须写在一行的起始位置，一般在 <code class="docutils literal notranslate"><span class="pre">struct</span></code> 上部还有对该结构体全局
性的描述，采用块注释结构。</li>
<li><code class="docutils literal notranslate"><span class="pre">struct</span></code> 后只能加一个空格，然后键入结构体名。</li>
<li>结构体名称必须为小写，非应用程序（模块内部）使用的结构体名字前，必须有双下划
线 <code class="docutils literal notranslate"><span class="pre">__</span></code> 。</li>
<li>结构体名字的后面加一个空格，然后键入 <code class="docutils literal notranslate"><span class="pre">{</span></code> 。</li>
<li>结构体成员类型写在起始位置后四个空格处。</li>
<li>一个结构体所有成员必须左对齐，以英文字母或下划线作为起始对齐点。</li>
<li>在不同含义或不同类型的成员定义之间要加入空行。</li>
<li>每个成员右边要跟有行注释。</li>
<li>在最后一个成员的下一行起始位置写入： <code class="docutils literal notranslate"><span class="pre">};</span></code> 。</li>
<li>不允许在结构体中使用位域。</li>
</ol>
<p>如果程序中，需要使用类型来访问结构体，那么类型的定义必须紧跟结构体的定义，建议使
用结构体名后跟 <code class="docutils literal notranslate"><span class="pre">_t</span></code> 来命名结构体类型，如 <code class="docutils literal notranslate"><span class="pre">__dlist_t</span></code> 。</p>
<p>不建议定义结构体类型的指针类型，除非移植等确实需要。</p>
</div>
<div class="section" id="id8">
<h3>7.2.1.3.2. 应用程序内结构体命名与定义<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>在应用程序中定义的结构体前面不需要加入双下划线： <code class="docutils literal notranslate"><span class="pre">__</span></code> ，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_app_struct_var_def</span></code> 所示。</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-app-struct-var-def">
<div class="code-block-caption"><span class="caption-text">应用程序结构体变量定义范例</span><a class="headerlink" href="#example-app-struct-var-def" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">dlist</span> <span class="p">{</span>
    <span class="kt">int</span>                  <span class="n">value</span><span class="p">;</span>      <span class="cm">/* 节点的数值 */</span>

    <span class="k">struct</span> <span class="n">dlist</span>        <span class="o">*</span><span class="n">p_next</span><span class="p">;</span>     <span class="cm">/* 双链表前向指针 */</span>
    <span class="k">struct</span> <span class="n">dlist</span>        <span class="o">*</span><span class="n">p_prev</span><span class="p">;</span>     <span class="cm">/* 双链表后向指针 */</span>
<span class="p">};</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">dlist</span>     <span class="n">dlist_t</span><span class="p">;</span>    <span class="cm">/* 定义类型 */</span>

<span class="cm">/* 需要使用struct dlist的结构体 */</span>
<span class="k">struct</span> <span class="n">my_app_struct</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">dlist</span>   <span class="n">dlist_node</span><span class="p">;</span>       <span class="cm">/* 链表节点 */</span>
    <span class="k">struct</span> <span class="n">dlist</span>  <span class="o">*</span><span class="n">p_dlist_head</span><span class="p">;</span>     <span class="cm">/* 链表头指针 */</span>
    <span class="kt">void</span>         <span class="p">(</span><span class="o">*</span><span class="n">pfn_act</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>   <span class="cm">/* 动作函数指针 */</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm">  双链表表头指针全局变量定义</span>
<span class="cm">***************************************************************************/</span>
<span class="n">dlist_t</span>     <span class="o">*</span><span class="n">gp_dlist_header</span><span class="p">;</span>       <span class="cm">/* 表头指针 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>要求</strong>：</p>
<ol class="arabic simple">
<li>当一个结构在程序中出现次数非常多，应该将此结构体定义为类型。</li>
<li>对于编译器或CPU冲突的C类型，也可以写成结构，建议使用标准C已经定义的类型或结构，例如： <code class="docutils literal notranslate"><span class="pre">uint8_t</span></code> 、 <code class="docutils literal notranslate"><span class="pre">uint32_t</span></code> 等（在标准头文件 <code class="docutils literal notranslate"><span class="pre">stdint.h</span></code> 中）。</li>
<li>严禁使用 <code class="docutils literal notranslate"><span class="pre">#define</span></code> 语句将C类型定义为宏。如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_define_def_macro_bad</span></code> 所示，就会出现严重错误。</li>
</ol>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-define-def-macro-bad">
<div class="code-block-caption"><span class="caption-text">#define语句定义的宏类型错误范例</span><a class="headerlink" href="#example-define-def-macro-bad" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PINT        int*</span>

<span class="n">PINT</span>    <span class="n">p_a</span><span class="p">,</span> <span class="n">p_b</span><span class="p">,</span> <span class="n">p_c</span><span class="p">;</span>  <span class="cm">/* 定义三个指针变量 */</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>以上代码只有 <code class="docutils literal notranslate"><span class="pre">p_a</span></code> 为指针变量，其余都为 <code class="docutils literal notranslate"><span class="pre">int</span></code> 型变量。</p>
<ol class="arabic simple" start="4">
<li>如果定义的是结构体类型，类型名尽量与结构体名统一。</li>
</ol>
<p>下面给出部分类型定义范例，如 <code class="xref std std-numref docutils literal notranslate"><span class="pre">example_tyedef</span></code> 所示。（模块内部类型前面加双下划线 <code class="docutils literal notranslate"><span class="pre">__</span></code> ）</p>
<blockquote>
<div><div class="literal-block-wrapper docutils container" id="example-tyedef">
<div class="code-block-caption"><span class="caption-text">类型定义范例</span><a class="headerlink" href="#example-tyedef" title="Permalink to this code">¶</a></div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="n">list</span>           <span class="n">list_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">udp_header</span>     <span class="n">udp_header_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="nf">void</span>                <span class="p">(</span><span class="o">*</span><span class="n">task_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p><strong>数据变量的类型定义要求</strong>：</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">typedef</span></code> 关键字必须写在一行的起始处。</li>
<li><code class="docutils literal notranslate"><span class="pre">typedef</span></code> 关键字后加一个空格，然后紧跟原始类型名。</li>
<li>新定义的类型名要求左对齐，以英文字母或下划线作为起始对齐点。</li>
<li>每个类型定义要有相关类型说明的行注释。</li>
<li>当语句长度超过80个字符时，可以将行注释独立一行，放在上边。（语句后加上空行）</li>
<li>类型名必须全部小写，且必须是两个字符以上，后跟 <code class="docutils literal notranslate"><span class="pre">_t</span></code> 结束。</li>
<li>与结构体相同，类型名中间允许使用下划线。</li>
</ol>
<p><strong>函数类型及函数指针类型定义附加要求</strong>：</p>
<ol class="arabic simple">
<li>函数或函数指针类型的类型名，与变量类型名要求对齐。以英文字母或下划线作为起始对齐点。</li>
<li>函数的返回类型名要求与变量类型定义的原始类型名对齐。</li>
<li>函数参数括号要紧贴函数类型名。</li>
</ol>
<p>其他函数定义及声明标准，见后面章节。</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="statement-operator.html" class="btn btn-neutral float-right" title="7.2.2. 语句、语句块、赋值与运算符" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="7.2. C代码规范" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, 广州致远电子.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>